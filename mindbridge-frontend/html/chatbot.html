<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot</title>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <!-- Chatbot Page -->
  <div class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
          AI Mental Health Assistant
        </h1>
        <p class="mt-4 text-lg text-gray-600">
          Get 24/7 support with our AI assistant. Available in multiple languages
          with sentiment detection.
        </p>
      </div>

      <!-- Language and Settings Bar -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-2">
              <label class="text-sm font-medium text-gray-700">Language:</label>
              <select id="chat-language"
                class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option value="en">English</option>
                <option value="hi">हिंदी</option>
                <option value="gu">ગુજરાતી</option>
              </select>
            </div>
            <div class="flex items-center space-x-2">
              <label class="text-sm font-medium text-gray-700">Anonymous Mode:</label>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="anonymous-mode" class="sr-only peer" />
                <div
                  class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600">
                </div>
              </label>
            </div>
          </div>
          <div class="flex items-center space-x-2">
            <button id="escalate-btn"
              class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
              <i class="fas fa-user-md mr-2"></i>
              Talk to a Counselor
            </button>
            <button id="clear-chat"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
              <i class="fas fa-trash mr-2"></i>
              Clear Chat
            </button>
          </div>
        </div>
      </div>

      <!-- Main Chat Container -->
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Chat Area -->
        <div class="lg:col-span-3">
          <div class="bg-white rounded-lg shadow-lg h-[600px] flex flex-col">
            <!-- Chat Header -->
            <div class="bg-indigo-600 text-white px-6 py-4 rounded-t-lg flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center">
                  <i class="fas fa-robot text-xl"></i>
                </div>
                <div>
                  <h3 class="font-semibold">MindWell Assistant</h3>
                  <p class="text-sm text-indigo-200">Online now</p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-sm">Active</span>
              </div>
            </div>

            <!-- Sentiment Indicator -->
            <div class="bg-gray-50 px-6 py-2 border-b">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700">Mood Indicator:</span>
                <div class="flex items-center space-x-2">
                  <div id="mood-bar" class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div id="mood-fill"
                      class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 transition-all duration-500"
                      style="width: 50%"></div>
                  </div>
                  <span id="mood-text" class="text-sm text-gray-600">Neutral</span>
                </div>
              </div>
            </div>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
              <!-- Welcome Message -->
              <div class="flex items-start space-x-3">
                <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                  <i class="fas fa-robot text-white text-sm"></i>
                </div>
                <div class="bg-gray-100 rounded-lg px-4 py-3 max-w-md">
                  <p class="text-gray-800">
                    Hello! I'm your MindWell assistant. I'm here to provide
                    support and guidance. How can I help you today?
                  </p>
                  <div class="text-xs text-gray-500 mt-1">Just now</div>
                </div>
              </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="px-6 py-2 hidden">
              <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center">
                  <i class="fas fa-robot text-white text-sm"></i>
                </div>
                <div class="bg-gray-100 rounded-lg px-4 py-3">
                  <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Input Area -->
            <div class="border-t bg-white p-4">
              <div class="flex space-x-2">
                <input type="text" id="chat-input" placeholder="Type your message here..."
                  class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                <button id="send-message"
                  class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>

              <!-- Suggested Responses -->
              <div id="suggested-responses" class="mt-3 flex flex-wrap gap-2">
                <button
                  class="suggested-btn bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 transition-colors">
                  I'm feeling anxious
                </button>
                <button
                  class="suggested-btn bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 transition-colors">
                  I need help with stress
                </button>
                <button
                  class="suggested-btn bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 transition-colors">
                  I want to book a session
                </button>
                <button
                  class="suggested-btn bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 transition-colors">
                  Show me resources
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <!-- Quick Actions -->
          <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
            <h3 class="font-semibold text-gray-900 mb-3">Quick Actions</h3>
            <div class="space-y-2">
              <button
                class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md transition-colors">
                <i class="fas fa-clipboard-check mr-2 text-indigo-500"></i>
                Take Screening Test
              </button>
              <button
                class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md transition-colors">
                <i class="fas fa-calendar-alt mr-2 text-indigo-500"></i>
                Book a Session
              </button>
              <button
                class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md transition-colors">
                <i class="fas fa-book-reader mr-2 text-indigo-500"></i>
                Browse Resources
              </button>
              <button
                class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-md transition-colors">
                <i class="fas fa-users mr-2 text-indigo-500"></i>
                Join Forum
              </button>
            </div>
          </div>

          <!-- Crisis Resources -->
          <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
            <h3 class="font-semibold text-red-900 mb-2">Crisis Support</h3>
            <p class="text-sm text-red-700 mb-3">
              If you're in immediate danger:
            </p>
            <div class="space-y-2 text-sm">
              <div class="flex items-center justify-between">
                <span class="text-red-700">Emergency:</span>
                <a href="tel:112" class="text-red-600 font-medium">112</a>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-red-700">Crisis Line:</span>
                <a href="tel:988" class="text-red-600 font-medium">988</a>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-red-700">Text Line:</span>
                <span class="text-red-600 font-medium">741741</span>
              </div>
            </div>
          </div>

          <!-- Chat History -->
          <div class="bg-white rounded-lg shadow-sm p-4">
            <h3 class="font-semibold text-gray-900 mb-3">Recent Conversations</h3>
            <div class="space-y-2 text-sm text-gray-600">
              <div class="p-2 hover:bg-gray-50 rounded cursor-pointer">
                <div class="font-medium">Today</div>
                <div class="text-xs text-gray-500">Started 2 hours ago</div>
              </div>
              <div class="p-2 hover:bg-gray-50 rounded cursor-pointer">
                <div class="font-medium">Yesterday</div>
                <div class="text-xs text-gray-500">About stress management</div>
              </div>
              <div class="p-2 hover:bg-gray-50 rounded cursor-pointer">
                <div class="font-medium">3 days ago</div>
                <div class="text-xs text-gray-500">General support</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    class EnhancedChatbot {
      constructor() {
        this.messages = [];
        this.currentLanguage = "en";
        this.isAnonymous = false;
        this.sentimentScore = 0.5; // 0 = very negative, 1 = very positive
        this.initialize();
      }

      initialize() {
        this.addEventListeners();
        this.loadLanguagePreference();
        this.updateSentimentDisplay();
      }

      addEventListeners() {
        // Send message
        document
          .getElementById("send-message")
          .addEventListener("click", () => this.sendMessage());
        document
          .getElementById("chat-input")
          .addEventListener("keypress", (e) => {
            if (e.key === "Enter") this.sendMessage();
          });

        // Language change
        document
          .getElementById("chat-language")
          .addEventListener("change", (e) => {
            this.currentLanguage = e.target.value;
            this.updateLanguage();
          });

        // Anonymous mode
        document
          .getElementById("anonymous-mode")
          .addEventListener("change", (e) => {
            this.isAnonymous = e.target.checked;
            this.updateAnonymousMode();
          });

        // Suggested responses
        document.querySelectorAll(".suggested-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            document.getElementById("chat-input").value = e.target.textContent;
            this.sendMessage();
          });
        });

        // Clear chat
        document
          .getElementById("clear-chat")
          .addEventListener("click", () => this.clearChat());

        // Escalate to counselor
        document
          .getElementById("escalate-btn")
          .addEventListener("click", () => this.escalateToCounselor());
      }

      loadLanguagePreference() {
        const savedLang = localStorage.getItem("chat-language") || "en";
        document.getElementById("chat-language").value = savedLang;
        this.currentLanguage = savedLang;
      }

      updateLanguage() {
        localStorage.setItem("chat-language", this.currentLanguage);
        console.log("Language changed to:", this.currentLanguage);
      }

      updateAnonymousMode() {
        console.log("Anonymous mode:", this.isAnonymous ? "enabled" : "disabled");
      }

      sendMessage() {
        const input = document.getElementById("chat-input");
        const message = input.value.trim();

        if (!message) return;

        // Add user message
        this.addMessage("user", message);
        input.value = "";

        // Clear suggested responses
        this.clearSuggestedResponses();

        // Show typing indicator
        this.showTypingIndicator();

        // Analyze sentiment and generate response
        setTimeout(() => {
          this.analyzeSentiment(message);
          this.hideTypingIndicator();
          this.generateResponse(message);
        }, 1000 + Math.random() * 1000);
      }

      addMessage(sender, text, timestamp = new Date()) {
        const messagesContainer = document.getElementById("chat-messages");
        const messageDiv = document.createElement("div");

        messageDiv.className = `flex items-start space-x-3 ${sender === "user" ? "flex-row-reverse space-x-reverse" : ""
          }`;

        const avatar = document.createElement("div");
        avatar.className = `w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${sender === "user" ? "bg-indigo-600" : "bg-indigo-500"
          }`;
        avatar.innerHTML =
          sender === "user"
            ? '<i class="fas fa-user text-white text-sm"></i>'
            : '<i class="fas fa-robot text-white text-sm"></i>';

        const messageBubble = document.createElement("div");
        messageBubble.className = `rounded-lg px-4 py-3 max-w-md ${sender === "user"
            ? "bg-indigo-600 text-white"
            : "bg-gray-100 text-gray-800"
          }`;

        messageBubble.innerHTML = `
            <p>${text}</p>
            <div class="text-xs ${sender === "user" ? "text-indigo-200" : "text-gray-500"
          } mt-1">
                ${timestamp.toLocaleTimeString()}
            </div>
        `;

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(messageBubble);
        messagesContainer.appendChild(messageDiv);

        // Scroll to bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        // Store message
        this.messages.push({ sender, text, timestamp });
      }

      showTypingIndicator() {
        document.getElementById("typing-indicator").classList.remove("hidden");
        document.getElementById("chat-messages").scrollTop =
          document.getElementById("chat-messages").scrollHeight;
      }

      hideTypingIndicator() {
        document.getElementById("typing-indicator").classList.add("hidden");
      }

      analyzeSentiment(text) {
        // Simple sentiment analysis based on keywords
        const positiveWords = [
          "good",
          "great",
          "happy",
          "better",
          "thanks",
          "thank you",
          "helpful",
          "amazing",
          "wonderful",
        ];
        const negativeWords = [
          "bad",
          "terrible",
          "awful",
          "sad",
          "depressed",
          "anxious",
          "worried",
          "scared",
          "angry",
          "frustrated",
        ];

        const words = text.toLowerCase().split(/\s+/);
        let positiveCount = 0;
        let negativeCount = 0;

        words.forEach((word) => {
          if (positiveWords.includes(word)) positiveCount++;
          if (negativeWords.includes(word)) negativeCount++;
        });

        if (positiveCount > negativeCount) {
          this.sentimentScore = Math.min(1, this.sentimentScore + 0.2);
        } else if (negativeCount > positiveCount) {
          this.sentimentScore = Math.max(0, this.sentimentScore - 0.2);
        }

        this.updateSentimentDisplay();
      }

      updateSentimentDisplay() {
        const moodFill = document.getElementById("mood-fill");
        const moodText = document.getElementById("mood-text");

        const percentage = this.sentimentScore * 100;
        moodFill.style.width = `${percentage}%`;

        let moodLabel;
        if (this.sentimentScore < 0.3) {
          moodLabel = "Struggling";
          moodFill.style.background =
            "linear-gradient(to right, #ef4444, #f59e0b)";
        } else if (this.sentimentScore < 0.7) {
          moodLabel = "Neutral";
          moodFill.style.background =
            "linear-gradient(to right, #f59e0b, #10b981)";
        } else {
          moodLabel = "Positive";
          moodFill.style.background =
            "linear-gradient(to right, #10b981, #059669)";
        }

        moodText.textContent = moodLabel;
      }

      generateResponse(userMessage) {
        const message = userMessage.toLowerCase();
        let response;

        // Enhanced response logic with multilingual support
        const responses = {
          en: {
            greeting:
              "Hello! I'm here to help you with your mental health needs. How are you feeling today?",
            anxiety:
              "I understand you're feeling anxious. That's completely normal. Would you like to try some breathing exercises or talk about what's causing your anxiety?",
            depression:
              "I'm sorry you're feeling this way. It's important to know that you're not alone. Would you like me to help you find some resources or connect you with a counselor?",
            stress:
              "Stress can be overwhelming. Let's work together to find some strategies that might help. What's been causing you the most stress lately?",
            help: "I'm here to help! You can ask me about mental health resources, book a counseling session, or just talk about what's on your mind. What would you like to do?",
            booking:
              "I can help you book a session with one of our licensed counselors. Would you like me to show you available counselors and their specializations?",
            resources:
              "I have access to many helpful resources including articles, videos, and self-help tools. What specific area would you like to explore?",
            default:
              "I'm here to help with your mental health needs. You can ask me about resources, book a session, or just share what's on your mind.",
          },
          hi: {
            greeting:
              "नमस्ते! मैं आपकी मानसिक स्वास्थ्य जरूरतों में मदद के लिए यहाँ हूँ। आज आप कैसा महसूस कर रहे हैं?",
            anxiety:
              "मैं समझता हूँ कि आप चिंतित महसूस कर रहे हैं। यह बिल्कुल सामान्य है। क्या आप कुछ साँस लेने के व्यायाम करना चाहेंगे या अपनी चिंता के बारे में बात करना चाहेंगे?",
            default:
              "मैं आपकी मानसिक स्वास्थ्य जरूरतों में मदद के लिए यहाँ हूँ। आप मुझसे संसाधनों, सत्र बुक करने या अपनी बात साझा करने के बारे में पूछ सकते हैं।",
          },
          gu: {
            greeting:
              "નમસ્તે! હું તમારી માનસિક આરોગ્ય જરૂરિયાતોમાં મદદ કરવા માટે અહીં છું। આજે તમે કેવી રીતે અનુભવો છો?",
            anxiety:
              "હું સમજું છું કે તમે ચિંતિત અનુભવો છો. આ સંપૂર્ણપણે સામાન્ય છે। શું તમે કેટલાક શ્વાસ લેવાના વ્યાયામ કરવા માંગો છો અથવા તમારી ચિંતા વિશે વાત કરવા માંગો છો?",
            default:
              "હું તમારી માનસિક આરોગ્ય જરૂરિયાતોમાં મદદ કરવા માટે અહીં છું। તમે મને સંસાધનો, સત્ર બુક કરવા અથવા તમારી વાત શેર કરવા વિશે પૂછી શકો છો।",
          },
        };

        const langResponses = responses[this.currentLanguage] || responses.en;

        if (
          message.includes("hello") ||
          message.includes("hi") ||
          message.includes("hey") ||
          message.includes("नमस्ते") ||
          message.includes("નમસ્તે")
        ) {
          response = langResponses.greeting;
        } else if (
          message.includes("anxious") ||
          message.includes("anxiety") ||
          message.includes("चिंता") ||
          message.includes("ચિંતા")
        ) {
          response = langResponses.anxiety;
        } else if (
          message.includes("sad") ||
          message.includes("depressed") ||
          message.includes("down") ||
          message.includes("उदास") ||
          message.includes("ઉદાસ")
        ) {
          response = langResponses.depression;
        } else if (
          message.includes("stress") ||
          message.includes("stressed") ||
          message.includes("तनाव") ||
          message.includes("તણાવ")
        ) {
          response = langResponses.stress;
        } else if (
          message.includes("help") ||
          message.includes("support") ||
          message.includes("मदद") ||
          message.includes("મદદ")
        ) {
          response = langResponses.help;
        } else if (
          message.includes("book") ||
          message.includes("session") ||
          message.includes("counselor") ||
          message.includes("सत्र") ||
          message.includes("સત્ર")
        ) {
          response = langResponses.booking;
        } else if (
          message.includes("resource") ||
          message.includes("material") ||
          message.includes("संसाधन") ||
          message.includes("સંસાધન")
        ) {
          response = langResponses.resources;
        } else {
          response = langResponses.default;
        }

        this.addMessage("bot", response);
        this.updateSuggestedResponses();
      }

      updateSuggestedResponses() {
        const suggestions = {
          en: [
            "I'm feeling anxious",
            "I need help with stress",
            "I want to book a session",
            "Show me resources",
          ],
          hi: [
            "मैं चिंतित महसूस कर रहा हूँ",
            "मुझे तनाव में मदद चाहिए",
            "मैं एक सत्र बुक करना चाहता हूँ",
            "मुझे संसाधन दिखाएं",
          ],
          gu: [
            "હું ચિંતિત અનુભવું છું",
            "મને તણાવમાં મદદ જોઈએ છે",
            "હું એક સત્ર બુક કરવા માંગું છું",
            "મને સંસાધનો બતાવો",
          ],
        };

        const langSuggestions =
          suggestions[this.currentLanguage] || suggestions.en;
        const container = document.getElementById("suggested-responses");

        container.innerHTML = langSuggestions
          .map(
            (suggestion) =>
              `<button class="suggested-btn bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm hover:bg-indigo-100 transition-colors">${suggestion}</button>`
          )
          .join("");

        // Re-add event listeners
        container.querySelectorAll(".suggested-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            document.getElementById("chat-input").value = e.target.textContent;
            this.sendMessage();
          });
        });
      }

      clearSuggestedResponses() {
        document.getElementById("suggested-responses").innerHTML = "";
      }

      clearChat() {
        if (confirm("Are you sure you want to clear the chat history?")) {
          document.getElementById("chat-messages").innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-sm"></i>
                    </div>
                    <div class="bg-gray-100 rounded-lg px-4 py-3 max-w-md">
                        <p class="text-gray-800">Hello! I'm your MindWell assistant. I'm here to provide support and guidance. How can I help you today?</p>
                        <div class="text-xs text-gray-500 mt-1">Just now</div>
                    </div>
                </div>
            `;
          this.messages = [];
          this.sentimentScore = 0.5;
          this.updateSentimentDisplay();
        }
      }

      escalateToCounselor() {
        if (
          confirm(
            "Would you like to be connected to a human counselor? This will redirect you to our booking system."
          )
        ) {
          window.location.hash = "#booking";
        }
      }
    }

    // Initialize chatbot when page loads
    document.addEventListener("DOMContentLoaded", () => {
      window.enhancedChatbot = new EnhancedChatbot();
    });
  </script>

</body>

</html>